
# 1.MCU工作流程

MCU工作框图

![](https://i.imgur.com/hYODkX2.png)

**说明：首次上电MCU需要等待3秒钟才能给WiFi模组发送数据。**

## 1.1 绑定流程
### 1.1.1. 绑定流程图

![](https://i.imgur.com/SDAlswS.png)

**说明：**


- 每次重新绑定设备，MCU都需要发送绑定命令给WiFi模组；
- MCU发送绑定命令前，必须先发心跳查询，收到WiFi模组心跳回复再发绑定命令；如果未收到WiFi模组心跳回复则重启WiFi模组，重启后还是发心跳查询；
### 1.1.2. 心跳命令


- MCU发送WiFi模组心跳命令0108

    `5A 00 16 10 00 00 00 00 02 00 00 01 08 00 00 00 00 00 00 00 00 43 24` 


- WiFi模组回复MCU心跳包命令0208

     `5A 00 16 10 79 00 00 00 02 03 00 02 08 00 00 00 00 00 00 00 00 1A 73` 

**第5个字节“79”为WiFi状态。**
### 1.1.3. 绑定命令


- MCU发送WiFi模组绑定命令0150


    5A 00 66 12 00 00 00 00 03 00 00 01 50 00 00 C5 58 00 0B 01 08 30 32 32 64 66 34 35 30 65 39 33 33 34 64 63 38 61 62 37 35 36 37 35 34 36 31 36 31 36 62 34 62 01 00 00 00 01 00 00 00 00 00 0B 03 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 3F
 
- WiFi模组回复MCU绑定命令0250

    5A 00 0E 12 00 00 00 00 03 03 00 02 50 FA 2B

**第4个字节，AP绑定命令为“12”，其他命令为“10”。**
## 1.2  正常流程

![](https://i.imgur.com/5Uuue4o.png)

## 1.3 产测流程

![](https://i.imgur.com/1lYJO0x.png)

# 2.调试说明
## 2.1 登录


- 进入C-Life开放平台“设备调试”页面，添加调试账号（C-Life账号）、添加设备的MAC地址；
- 点击“进入模拟调试”，进入调试窗口，查看C-Life开放平台与设备数据交互；

![](https://i.imgur.com/bLUQLmT.png)

## 2.2 设备绑定

![](https://i.imgur.com/vvgaPym.png)

绑定流程：

- 第1帧数据：命令字0402；
- 第2帧数据：命令字0202；
- 第3帧数据：命令字0401；设备上传“Device KEY[32]+USER  KEY[32]+设备硬件信息”；
- 第4帧数据：命令字0201；
- 第5帧数据：命令字0408；WiFi模组与服务器的心跳包，与MCU无关；
- 第6帧数据：命令字0208；WiFi模组与服务器的心跳包，与MCU无关；
## 2.3 设备控制


- 设备上传控制命令0104

    5A 00 3E 10 00 00 00 00 03 00 00 01 04 01 02 03 04 99 01 02 03 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 79 85

- C-Life开放平台回复控制命令0204

    5A 00 0E 10 B4 00 00 00 03 01 00 02 04 7C 2D 

- C-Life开放平台下发控制命令0104

![](https://i.imgur.com/RHneAfa.png)

操作步骤：

- 第1步：选中设备上传控制命令0104；
- 第2步：修改控制命令内容；
- 第3步：点击“下发控制命令”；
- 第4步：C-Life开放平台显示“控制命令0104、下行数据”；
- 第5步：C-Life开放平台显示设备回复“控制命令0204、上行数据”；



































